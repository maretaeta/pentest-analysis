<template>
    <div class="px-10 lg:px-20 w-full relative xl:px-20 pt-16">
        <div class="pb-4">
            <div class="flex gap-2">
                <h1 class="font-semibold text-xl">Temuan</h1>
                <vue-feather type="help-circle" size="18" class="text-gray-400 p-1" />
            </div>
            <p class="text-sm text-gray-500">Terdapat {{ allRows.length }} temuan</p>
        </div>
        <div class="gap-7 w-full">
          <div class="w-full bg-white shadow-sm rounded-xl overflow-x-auto">
            <table class="min-w-full table-auto">
              <thead>
                <tr class="">
                  <th class="py-4 px-6 text-left font-medium text-md border-b">Temuan</th>
                  <th class="py-4 text-left font-medium text-md border-b">Level Temuan</th>
                  <th class="py-4 px-6 text-left font-medium text-md border-b">Tanggal</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="(row, index) in allRows" :key="index">
                  <td class="py-4 px-6 xl:w-3/5 border-b">{{ row }}</td>
                  <td class="py-4 border-b flex gap-2 items-center">
                    <span class="w-2 h-2 rounded-full mt-1" :class="getLevelClass(store.resultInfo.result.header[row])"></span>
                    <span :class="store.resultInfo.result.header[row] ? 'text-green-500' : 'text-red-600'">
                        {{ getStatus(store.resultInfo.result.header[row]) }}
                    </span>
                  </td>
                  <td class="py-4 px-6 border-b">{{ currentDate() }}</td>
                </tr>
              </tbody>
            </table>
            <div v-if="showMoreButton" @click="toggleShowMoreRows" class="flex gap-2 p-4 justify-center items-center w-full text-blue-500">
              <p>{{ buttonText }}</p>
              <vue-feather :type="showMoreRows ? 'chevron-down' : 'chevron-up'" size="18" class="p-1 rotate-icon" />
            </div>
          </div>
            <div class="">
                <InformationCard />
            </div>
        </div>
    </div>
</template>

<script>
import { ref } from "vue";
import VueFeather from "vue-feather";
import InformationCard from "../components/Card/InformationCard.vue";
import { useResult } from "../store";

export default {
    
    data() {
        const store = useResult()
        return {
            store,
            showMoreRows: true,
            allRows: Object.keys(store.resultInfo.result.header),
            visibleRows: [],
            rowsPerPage: 5,
        };
    },

    computed: {
        // visibleRows() {
        //     return this.showMoreRows ? this.allRows.slice(0, this.rowsPerPage) : this.allRows.slice();
        // },
        // showMoreButton() {
        //     return this.allRows.length > this.visibleRows.length;
        // },
        buttonText() {
            return this.showMoreRows ? 'Lebih banyak' : 'Lebih sedikit';
        },
    },

    methods: {
        currentDate(){
            return new Date().toDateString()
        },
        //    toggleShowMoreRows() {
        //     this.showMoreRows = !this.showMoreRows;
        //     const icon = document.querySelector('.rotate-icon');
        //     if (icon) {
        //         icon.classList.toggle('rotate180', !this.showMoreRows);
        //     }
        // },

        // getLevelClass(level) {
        //     const levelClassMap = {
        //         'Critical': 'bg-red-600',
        //         'Medium': 'bg-yellow-400',
        //         'Low': 'bg-green-500',
        //     };

        //     return levelClassMap[level] || '';
        // },
        getLevelClass(status) {
            return !status ? "bg-red-600" : "bg-green-500"
        },
        getStatus(status){
            return !status ? "Critical" : "Low"
        }
    },

    mounted() {
        // this.visibleRows = this.allRows.slice(0, this.rowsPerPage);
    },

    

    components: {
        VueFeather,
        InformationCard,
    },
};
</script>